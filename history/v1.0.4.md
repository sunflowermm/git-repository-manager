# v1.0.4 更新日志

## ✨ 新功能
- 优化更新弹窗交互：中间显示 Markdown 更新说明，底部「安装」「取消」按钮
- 独立进度条弹窗：点击「安装」后单独显示进度条，实时更新下载进度
- 更新完成选项：下载完成后提供「立即重启」和「稍后」两个选项

## 🔧 优化
- **事件链优化**：确保进度弹窗在下载开始前完全渲染，避免进度事件丢失
- **删除冗余日志**：移除不必要的日志输出，仅保留关键错误提示
- **事件监听器保护**：确保更新事件监听器只注册一次，避免重复触发
- **错误处理优化**：改进弹窗关闭逻辑，避免关闭不存在的弹窗导致错误
- **代码结构优化**：梳理更新系统事件流程，删除冗余代码和重复逻辑

## 🐛 修复
- 修复进度更新时机问题：进度事件可能在标志设置前到达导致丢失
- 修复弹窗关闭逻辑：增加存在性检查，避免关闭不存在的弹窗
- 修复事件监听器重复注册问题：添加标志位防止重复注册

## 📝 事件流程说明
1. 用户点击「检查更新」→ IPC 调用主进程
2. 主进程检查更新 → 发送状态事件到渲染进程
3. 发现更新 → 显示「发现新版本」弹窗（中间 MD，底部「安装」「取消」）
4. 用户点击「安装」→ 关闭弹窗 → 显示进度弹窗 → 开始下载
5. 下载进度 → 实时更新进度条和百分比
6. 下载完成 → 关闭进度弹窗 → 显示「更新已就绪」弹窗（「立即重启」「稍后」）
7. 用户选择 → 「立即重启」立即应用更新，或「稍后」在关闭/重启时自动安装
