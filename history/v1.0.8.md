# v1.0.8 更新日志

## 🔧 修复与优化

### 状态传递修复（解决「收到状态 (未知)」）
- **IPC 双参数发送**：主进程改为 `send('update-status', status, payload)` 单独传 `status`，渲染进程用 `(e, status, payload)` 接收后拼成 `data = { status, ...payload }`，避免 payload 或序列化导致 `status` 丢失
- **兜底日志**：若仍收到空 status，会打一条 `更新: 调试 data.keys=...` 便于排查

### 调试日志完善（便于打包后 App 内排查）
- **主进程 → 操作日志**：新增 `sendUpdateLog()` 与渲染进程对 `update-log` 的监听，主进程的调试信息统一写入「操作日志」
- **详细错误日志**：新增 `formatErrorForLog(err)`，输出 `[错误] 消息 + 堆栈前 8 行`；所有更新相关 catch 与 `autoUpdater.on('error')` 均先 `sendUpdateLog(详细错误)` 再发 status，便于定位网络/代理/electron-updater 问题
- **主进程日志**：启动时自动检查、IPC 收到检查请求、直连/代理检查完成、事件 update-not-available/update-available/update-downloaded、发送状态 xxx、runCheckWithTimeout 已 resolve 等待 autoUpdater 事件、直连/代理下载完成、即将退出并安装
- **渲染进程日志**：收到状态、已发起检查看门狗 15s、看门狗超时、开始下载、下载进度 100%、已下载弹窗选择重启、执行安装并重启、清除缓存请求/已清除缓存 (N 项) 等，统一带「更新:」前缀

### 行为说明
- 打包后仅在 App 内测试时，操作日志可完整追踪：检查请求 → 直连/代理 → 事件与状态 → 下载进度 → 安装并重启；错误时可见详细错误与堆栈
- 版本号升级为 1.0.8
