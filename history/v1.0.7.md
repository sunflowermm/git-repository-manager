# v1.0.7 更新日志

## 🔧 修复与优化（重点）

### 事件链修复
- **统一发送入口**：主进程所有更新状态改为通过 `sendUpdateStatus(status, payload)` 发送，`update-available` / `update-not-available` / `error` / `update-downloaded` 均经此入口，避免漏发或格式不一致
- **窗口校验**：发送前统一判断 `mainWindow && !mainWindow.isDestroyed()`，避免窗口关闭后仍发事件导致异常
- **错误与超时必显**：主进程超时或检查失败时发送 `update-status: error`，渲染进程在 `handleUpdateStatus` 的 `error` 分支中**同时**写操作日志并 `showMessage`，确保错误和超时都会在日志与界面显示

### 异步逻辑与冗余清理
- **主进程扁平化**：去掉 `setImmediate → runWithDirectFirstThenProxy → Promise.race` 多层嵌套，改为 `runCheckWithTimeout()` + `performUpdateCheck()` 两个清晰函数，入口仅 `setImmediate(() => performUpdateCheck().catch(...))`
- **下载更新**：`download-update` 不再套一层 `runWithDirectFirstThenProxy`，改为内联「先直连，失败再挂代理重试，finally 恢复」，与检查逻辑一致
- **渲染进程**：检查失败 / 下载失败时统一 `log` + `showMessage`；看门狗 15 秒超时兜底，到点即打日志并提示「检查更新超时，请重试」

### 行为说明
- 检查更新：先直连（12s 超时），失败再走 GH 代理重试（12s 超时）；超时或失败均会收到 `error` 并在界面与操作日志中显示
- 渲染进程 15s 看门狗：若主进程未在 15s 内返回任何结果，自动提示「检查更新超时，请重试」，避免一直停在「正在检查更新...」

## 📝 说明
- 版本号升级为 1.0.7，重点为更新事件链可靠性与错误/超时展示，以及异步结构与冗余代码清理。
